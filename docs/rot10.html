<strong>Objetivos</strong>:
<ul><li>Entender como funciona buffer circular utilizado entre sistema produtor/consumidor por interrupção</li><li>Implementar buffer circular de transmissão da UART0 por interrupção</li></ul>
Motivação:
Existem duas diferenças fundamentais entre a interrupção por recepção e por transmissão da UART.
<ol><li>Na inicialização, o transmissor estará pronto para transmitir e poderá gerar uma interrupção, entretanto não existe ainda caractere a ser impresso. Assim, a interrupção na transmissão deve ser desabilitada na inicialização</li><li>Normalmente quando se enviar caracteres para transmissão, envia-se na forma de "rajadas", um string contendo vários caracteres. E o processo de transmissão na UART obedece a taxa de transmissão do baud-rate. Para compatibilizar estas taxas diferentes, utiliza-se um buffer contendo vários caracteres: chamado buffer circular. O tratamento do buffer circular não é simples e trata-se de chamado problema produtor/consumidor que pode gerar condições de corrida.</li></ol>
<strong>Atividades:</strong>
<ul><li>Teste: <a href="http://goo.gl/forms/MGp949bnPE" target="_blank">Turma S</a>; <a href="http://goo.gl/forms/XysFCPaz1H" target="_blank">Turma T</a>; <a target="_blank" href="http://goo.gl/forms/Db1bnlz1A9">Turma E</a>; <a target="_blank" href="http://goo.gl/forms/qkLKk1pWIA">Turma M</a>; <a href="http://goo.gl/forms/MCwcmBE7AU" target="_blank">Turma W</a>; <a href="http://goo.gl/forms/jO4pb3rnFs" target="_blank">Turma U</a></li><li>Interrupção de TX da UART0 - manual KL25 Cap. 39 em especial 39.3.5
<ul><li>Habilitar a interrupção para transmissão de caracteres - registrador UART0_C2, bit TIE - Transmitter Interrupt Enable</li><li>O tratamento de interrupção é feito pela mesma rotina <b>void</b><strong> UART0_IRQHandler</strong>(<b>void</b>) utilizada no experimento anterior</li></ul>
</li><li>Funções de transmissão do terminal serial via interrupção utilizando Buffer Circular: ver @1414
<ul><li>modificar subrotina <strong>putchar_UART()</strong> para utilizar o buffer circular</li></ul>
</li></ul>
<strong>Programa a ser entregue na próxima aula:</strong>
<ul><li>prog10: Programa do cronômetro com interrupções do Systick e UART, mostrando tanto LCD como Terminal Serial. Agora a UART0 deve funcionar com interrupções tanto de recepção quanto de transmissão, usando buffer circular. Para observar o funcionamento do buffer circular, o número de caracteres no buffer circular deve ser constantemente mostrado na segunda linha do LCD e é necessário dotar de um mecanismo para pausar a impressão do cronômetro no terminal serial para que o buffer esvazie ou encha novamente, quando a impressão no terminal continuar.
<ul><li>A primeira linha do display do LCD deve estar constantemente mostrando o valor do cronômetro, mesmo se ele estiver com a contagem parada.</li><li>Atenção para atender as recomendações de nomes e funcionamentos das funções padronizadas: @764</li><li>Atenção na hora de imprimir o número de caracteres do buffer circular na segunda linha do display LCD pois o este número pode ter 4 algarismos. A recomendação é modificar a função int2ascii10 para a função int2ascii10n conforme descrito em @1642. Se for usar esta opção, simplifique o código do cronômetro, deixando de usar a função antiga int2ascii10.</li><li>Procure estruturar o seu programa para não ficar com muitas linhas e ser fácil de entender e dar manutenção. Veja o post sobre bons comentários: @1571</li></ul>
</li></ul>
<strong>Referências:</strong>
<ul><li>Manual da arquitetura ARM v6: <a href="https://d1b10bmlvqabco.cloudfront.net/attach/i406dyu4aw75jl/hzle6mt0zvk237/i7dpd4xb40ek/arm_v6m_reference_manual.pdf" target="_blank">arm_v6m_reference_manual.pdf</a> (NVIC - Seção B3.4)</li><li>Manual da KL25Z: <a href="https://d1b10bmlvqabco.cloudfront.net/attach/i406dyu4aw75jl/hzle6mt0zvk237/i6micg8in2nc/KL25P80M48SF0RM.pdf" target="_blank">KL25P80M48SF0RM.pdf</a> (NVIC - Seção 3.3.2, UART0 Cap. 39 e 39.3.5)</li></ul>
